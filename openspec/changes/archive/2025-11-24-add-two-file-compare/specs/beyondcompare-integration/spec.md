## ADDED Requirements

### Requirement: 两个文件比较

扩展 SHALL 支持用户选择工作区中的任意两个文件,并使用 Beyond Compare 进行比较,无需依赖 Git 仓库。支持两种选择方式:同时多选两个文件直接比较,或分两步依次选择文件进行比较。

#### Scenario: 同时选中两个文件直接比较

- **WHEN** 用户在资源管理器中按住 Ctrl/Cmd 同时选中两个文件
- **AND** 右键点击其中任一文件
- **AND** 选择"比较选中的文件"命令
- **THEN** 扩展应检测到有两个文件被选中
- **AND** 使用 Beyond Compare 直接比较这两个文件
- **AND** 第一个选中的文件显示在 Beyond Compare 左侧面板
- **AND** 第二个选中的文件显示在 Beyond Compare 右侧面板

#### Scenario: 选中非两个文件时菜单不显示

- **WHEN** 用户在资源管理器中选中一个文件、三个或更多文件
- **AND** 右键点击
- **THEN** "比较选中的文件"命令不应出现在上下文菜单中
- **AND** 保持菜单简洁，避免显示不可用的选项

#### Scenario: 选择第一个文件

- **WHEN** 用户在资源管理器中右键点击一个文件
- **AND** 选择"选择此文件进行比较"命令
- **THEN** 扩展应将该文件路径保存为第一个待比较文件
- **AND** 显示成功提示消息,告知用户已选择该文件
- **AND** 提示用户选择第二个文件进行比较

#### Scenario: 选择第二个文件并比较

- **WHEN** 用户已选择第一个文件
- **AND** 用户在资源管理器中右键点击另一个文件
- **AND** 选择"与已选文件比较"命令
- **THEN** 扩展应使用 Beyond Compare 比较两个文件
- **AND** 第一个文件显示在 Beyond Compare 左侧面板
- **AND** 第二个文件显示在 Beyond Compare 右侧面板
- **AND** 比较完成后,扩展应清除已选文件状态(或提供清除选项)

#### Scenario: 防御性检查 - 未选择第一个文件时执行命令

- **WHEN** 由于异常情况,"与已选文件比较"命令被执行但第一个文件状态为空
- **THEN** 扩展应记录错误日志
- **AND** 显示错误提示"请先选择第一个文件进行比较"
- **AND** 不启动 Beyond Compare
- **NOTE**: 正常情况下此场景不应发生,因为菜单条件已控制命令可见性

#### Scenario: 选择相同文件

- **WHEN** 用户选择第一个文件后
- **AND** 再次选择同一个文件作为第二个文件进行比较
- **THEN** 扩展应显示警告提示"不能比较同一个文件"
- **AND** 不启动 Beyond Compare
- **AND** 保持第一个文件的选中状态

#### Scenario: 文件不存在

- **WHEN** 用户选择第一个文件后,该文件被删除或移动
- **AND** 用户尝试选择第二个文件进行比较
- **THEN** 扩展应检测到第一个文件不存在
- **AND** 显示错误提示"第一个选中的文件已不存在,请重新选择"
- **AND** 清除已选文件状态

#### Scenario: Beyond Compare 启动失败

- **WHEN** 用户选择两个文件进行比较
- **AND** Beyond Compare 无法启动(如未安装、路径错误)
- **THEN** 扩展应显示友好的错误提示
- **AND** 错误消息应包含具体的失败原因
- **AND** 保持已选文件状态,允许用户修复问题后重试

### Requirement: 两个文件比较的右键菜单集成

扩展 SHALL 在资源管理器右键菜单中添加两个文件比较相关的命令选项,根据选中文件数量智能显示合适的命令。

#### Scenario: "比较选中的文件"菜单仅在选中两个文件时显示

- **WHEN** 用户在资源管理器中同时选中恰好两个文件
- **AND** 右键点击其中任一文件
- **THEN** 上下文菜单应包含"比较选中的文件"选项
- **AND** 该选项应位于合理的菜单分组中(建议与其他比较命令同组)
- **AND** 该选项应始终可用且可点击

#### Scenario: 选中非两个文件时菜单隐藏

- **WHEN** 用户选中多于两个文件、只选中一个文件、或未选中文件
- **AND** 右键点击
- **THEN** "比较选中的文件"选项不应出现在上下文菜单中

#### Scenario: "选择此文件进行比较"菜单仅在单选时显示

- **WHEN** 用户在资源管理器中右键点击单个文件(未多选)
- **THEN** 上下文菜单应包含"选择此文件进行比较"选项
- **AND** 该选项应位于合理的菜单分组中(建议与其他比较命令同组)
- **AND** 该选项仅在右键文件时显示,文件夹不显示

#### Scenario: "选择此文件进行比较"菜单在多选时隐藏

- **WHEN** 用户在资源管理器中同时选中多个文件
- **AND** 右键点击其中任一文件
- **THEN** "选择此文件进行比较"选项不应出现在上下文菜单中
- **AND** 避免与"比较选中的文件"命令混淆

#### Scenario: "与已选文件比较"菜单仅在已选第一个文件时显示

- **WHEN** 用户在资源管理器中右键点击文件
- **AND** 已经通过"选择此文件进行比较"命令选择了第一个文件
- **THEN** 上下文菜单应包含"与已选文件比较"选项
- **AND** 菜单项应显示已选文件的文件名(如"与 config.json 比较")
- **AND** 该选项仅在右键文件时显示,文件夹不显示

#### Scenario: "与已选文件比较"菜单在未选第一个文件时隐藏

- **WHEN** 用户在资源管理器中右键点击文件
- **AND** 尚未选择第一个文件(或已清除选择)
- **THEN** "与已选文件比较"选项不应出现在上下文菜单中

### Requirement: 选中文件状态管理

扩展 SHALL 管理用户选中的第一个文件的状态,并提供清除状态的机制。

#### Scenario: 状态持久化

- **WHEN** 用户选择第一个文件后
- **AND** 用户切换到其他编辑器标签或窗口
- **THEN** 已选文件状态应保持不变
- **AND** 用户返回后仍可选择第二个文件进行比较

#### Scenario: 比较完成后清除状态

- **WHEN** 用户成功比较两个文件
- **THEN** 扩展应自动清除已选文件状态
- **OR** 显示提示消息,询问用户是否清除已选文件

#### Scenario: 手动清除状态

- **WHEN** 用户选择第一个文件后改变主意
- **THEN** 扩展应提供"清除选中文件"命令(可选)
- **OR** 允许用户通过重新选择另一个文件覆盖当前选中

#### Scenario: 窗口关闭时状态清除

- **WHEN** 用户关闭 VSCode 窗口或重启编辑器
- **THEN** 已选文件状态应被清除
- **AND** 不应持久化到磁盘或跨会话保存

### Requirement: 状态栏显示和交互

扩展 SHALL 在状态栏显示当前已选择的第一个文件,并支持通过点击清除选中状态。

#### Scenario: 选择第一个文件后状态栏显示

- **WHEN** 用户通过"选择此文件进行比较"命令选择第一个文件
- **THEN** 状态栏左侧应显示一个状态栏项
- **AND** 状态栏项应显示文件图标和文件名(如 "$(file) config.json")
- **AND** 状态栏项应有工具提示"点击清除选中的文件"
- **AND** 状态栏项应可点击

#### Scenario: 点击状态栏项清除选中

- **WHEN** 用户点击状态栏上的文件名
- **THEN** 扩展应清除第一个文件的选中状态
- **AND** 状态栏项应立即隐藏
- **AND** 设置 `firstFileSelected` 上下文为 false
- **AND** "与已选文件比较"命令应从菜单中消失

#### Scenario: 比较完成后自动隐藏状态栏项

- **WHEN** 用户成功完成两个文件的比较
- **THEN** 扩展应自动清除选中状态
- **AND** 状态栏项应自动隐藏

#### Scenario: 未选择第一个文件时状态栏不显示

- **WHEN** 用户未执行"选择此文件进行比较"命令
- **OR** 已清除选中状态
- **THEN** 状态栏不应显示文件选择相关的状态栏项

### Requirement: 用户反馈和提示

扩展 SHALL 在用户执行两个文件比较操作时提供清晰的反馈和提示消息。

#### Scenario: 选择第一个文件时的提示

- **WHEN** 用户成功选择第一个文件
- **THEN** 扩展应显示信息提示消息
- **AND** 消息应包含已选文件的名称
- **AND** 消息应引导用户下一步操作(如"请选择第二个文件进行比较")

#### Scenario: 比较启动时的进度提示

- **WHEN** 用户选择第二个文件并开始比较
- **THEN** 扩展应显示进度提示(如"正在启动 Beyond Compare...")
- **AND** 操作完成后提示应自动消失

#### Scenario: 错误提示的清晰性

- **WHEN** 操作失败(如文件不存在、Beyond Compare 启动失败)
- **THEN** 扩展应显示清晰的错误消息
- **AND** 错误消息应说明失败原因
- **AND** 错误消息应提供解决建议(如"请检查文件是否存在")

### Requirement: 国际化支持

扩展的两个文件比较功能 SHALL 支持中英文国际化。

#### Scenario: 英文环境显示英文文本

- **WHEN** VSCode 的显示语言设置为英文
- **THEN** 命令名称、菜单项、提示消息应显示英文
- **AND** 例如:"Select this file to compare"、"Compare with selected file"

#### Scenario: 中文环境显示中文文本

- **WHEN** VSCode 的显示语言设置为简体中文
- **THEN** 命令名称、菜单项、提示消息应显示中文
- **AND** 例如:"选择此文件进行比较"、"与已选文件比较"

#### Scenario: 动态显示已选文件名

- **WHEN** 菜单项需要显示已选文件名称
- **THEN** 文件名应正确嵌入国际化文本中
- **AND** 例如:中文显示"与 config.json 比较",英文显示"Compare with config.json"

